<!DOCTYPE html>
<html>
<head>
  <title>Welcome</title>
</head>
<body>
  <h1>Write a comment</h1>
  <!-- Form for submitting new comments -->
  <form id="commentForm">
    <input name="comment" placeholder="Comment" required />
    <button type="submit">Submit</button>
  </form>

  <!-- Search bar -->
  <h2>Search Comments by User</h2>
  <form action="/search" method="GET">
    <input name="username" placeholder="Enter username" required>
    <button type="submit">Search</button>
  </form>

  <!-- List to display comments -->
  <ul id="commentList"></ul>

  <script>
    // Function to load and display comments from the server.js
    async function loadComments() {
      const res = await fetch('/comments');
      const comments = await res.json();
      const list = document.getElementById('commentList');
      list.innerHTML = '';
      comments.forEach(c => {
        const item = document.createElement('li');
        // Display each comment with options to delete or edit
        item.innerHTML = `
          <strong>${c.name}:</strong> <span>${c.comment}</span>
          <button onclick="deleteComment(${c.id})">Delete</button>
          <button onclick="editComment(${c.id}, '${c.comment.replace(/'/g, "\\'")}')">Edit</button>
        `;
        list.appendChild(item);
      });
    }

    // Event listener for posting a new comment
    document.getElementById('commentForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      await fetch('/create', {
        method: 'POST',
        body: new URLSearchParams(formData)
      });
      e.target.reset();
      loadComments();
    });

    // Delete comment
    async function deleteComment(id) {
      await fetch(`/delete/${id}`, { method: 'POST' });
      loadComments();
    }

    // Edit comment
    async function editComment(id, oldComment) {
      const newComment = prompt('Edit your comment:', oldComment);
      if (newComment !== null && newComment.trim() !== '') {
        await fetch(`/update/${id}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ comment: newComment })
        });
        loadComments();
      }
    }

    // Load comments on page load
    loadComments();
  </script>
</body>
</html>
